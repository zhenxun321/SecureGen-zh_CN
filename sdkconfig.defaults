# =============================================================================
# ESP32 T-Display TOTP - Secure Boot & Flash Encryption Configuration
# =============================================================================
# –í–ù–ò–ú–ê–ù–ò–ï: –í–∫–ª—é—á–µ–Ω–∏–µ —ç—Ç–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ù–ï–û–ë–†–ê–¢–ò–ú–û –∏–∑–º–µ–Ω–∏—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ!
# –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ!
#
# –î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏: –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –≤ sdkconfig.defaults
# =============================================================================

# ===== Stack Size Configuration =====
CONFIG_ARDUINO_LOOP_STACK_SIZE=16384
CONFIG_ESP_MAIN_TASK_STACK_SIZE=8192
CONFIG_ASYNC_TCP_STACK_SIZE=8192

# ===== üîê SECURE BOOT V2 Configuration =====
# –í–∫–ª—é—á–∞–µ—Ç Secure Boot –≤–µ—Ä—Å–∏–∏ 2 (RSA-PSS 3072-bit)
CONFIG_SECURE_BOOT=y
CONFIG_SECURE_BOOT_V2_ENABLED=y

# Development mode: –ø–æ–∑–≤–æ–ª—è–µ—Ç reflashing —á–µ—Ä–µ–∑ UART —Å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º–∏ –æ–±—Ä–∞–∑–∞–º–∏
# Production mode: –æ—Ç–∫–ª—é—á–∞–µ—Ç reflashing –ø–æ–ª–Ω–æ—Å—Ç—å—é
CONFIG_SECURE_BOOT_INSECURE=n
CONFIG_SECURE_BOOT_ENABLE_AGGRESSIVE_KEY_REVOKE=n

# –î–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
# CONFIG_SECURE_BOOT_ENABLE_AGGRESSIVE_KEY_REVOKE=y

# –ü—Ä–æ–≤–µ—Ä–∫–∞ signature –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
CONFIG_SECURE_BOOT_VERIFICATION_ENABLED=y

# ===== üîí FLASH ENCRYPTION Configuration =====
# –í–∫–ª—é—á–∞–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–π Flash –ø–∞–º—è—Ç–∏
CONFIG_SECURE_FLASH_ENC_ENABLED=y

# Development mode: –ø–æ–∑–≤–æ–ª—è–µ—Ç reflashing
# Release mode: –±–ª–æ–∫–∏—Ä—É–µ—Ç reflashing (—Ç–æ–ª—å–∫–æ OTA)
CONFIG_SECURE_FLASH_ENCRYPTION_MODE_DEVELOPMENT=y
# –î–ª—è production:
# CONFIG_SECURE_FLASH_ENCRYPTION_MODE_RELEASE=y

# –®–∏—Ñ—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ä–∞–∑–¥–µ–ª—ã Flash (NVS, SPIFFS, apps)
CONFIG_SECURE_FLASH_ENCRYPT_ALL_FLASH_CONTENTS=y

# –†–∞–∑–º–µ—Ä –±–ª–æ–∫–∞ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (32 bytes - –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è ESP32)
CONFIG_SECURE_FLASH_ENCRYPTION_AES256=y

# ===== üõ°Ô∏è Hardware Security Features =====
# –ê–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (mbedTLS)
CONFIG_MBEDTLS_HARDWARE_AES=y
CONFIG_MBEDTLS_HARDWARE_SHA=y
CONFIG_MBEDTLS_HARDWARE_MPI=y
CONFIG_MBEDTLS_HARDWARE_ECC=y

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hardware RNG –¥–ª—è entropy
CONFIG_ESP_SYSTEM_HWCRYPTO_ENABLED=y

# ===== üö´ Debug Interface Disable =====
# –ö–†–ò–¢–ò–ß–ù–û: –û—Ç–∫–ª—é—á–∏—Ç—å JTAG –≤ production!
CONFIG_ESP_SYSTEM_DISABLE_JTAG=y

# –û—Ç–∫–ª—é—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ –≤ download mode —á–µ—Ä–µ–∑ USB
# (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ - –º–æ–∂–µ—Ç –∑–∞—Ç—Ä—É–¥–Ω–∏—Ç—å recovery!)
# CONFIG_ESP_CONSOLE_USB_SERIAL_JTAG=n

# ===== ‚è±Ô∏è Watchdog Configuration =====
# Task watchdog –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏–π
CONFIG_ESP_TASK_WDT=y
CONFIG_ESP_TASK_WDT_TIMEOUT_S=5
CONFIG_ESP_TASK_WDT_PANIC=y
CONFIG_ESP_TASK_WDT_CHECK_IDLE_TASK_CPU0=y
CONFIG_ESP_TASK_WDT_CHECK_IDLE_TASK_CPU1=y

# Interrupt watchdog
CONFIG_ESP_INT_WDT=y
CONFIG_ESP_INT_WDT_TIMEOUT_MS=300

# ===== üîß Bootloader Configuration =====
# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è bootloader
CONFIG_BOOTLOADER_LOG_LEVEL_INFO=y
CONFIG_BOOTLOADER_LOG_LEVEL=3

# –ü—Ä–æ–≤–µ—Ä–∫–∞ signature app –ø—Ä–∏ –∫–∞–∂–¥–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
CONFIG_BOOTLOADER_APP_ROLLBACK_ENABLE=y

# Anti-rollback protection (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# CONFIG_BOOTLOADER_APP_ANTI_ROLLBACK=y

# ===== üåê Network Security =====
# WPA3 support (–µ—Å–ª–∏ —Ä–æ—É—Ç–µ—Ä –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç)
CONFIG_ESP_WIFI_ENABLE_WPA3_SAE=y

# Secure WiFi connect
CONFIG_ESP_WIFI_SOFTAP_SAE_SUPPORT=y

# ===== üìù Logging Configuration =====
# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (production - WARNING, development - INFO)
CONFIG_LOG_DEFAULT_LEVEL_INFO=y
CONFIG_LOG_DEFAULT_LEVEL=3

# –î–ª—è production:
# CONFIG_LOG_DEFAULT_LEVEL_WARN=y
# CONFIG_LOG_DEFAULT_LEVEL=2

# ===== üíæ NVS Configuration =====
# NVS encryption (–¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
CONFIG_NVS_ENCRYPTION=y

# ===== üîã Power Management =====
# –í–∫–ª—é—á–∏—Ç—å power management –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ —ç–Ω–µ—Ä–≥–∏–∏
CONFIG_PM_ENABLE=y

# Light sleep support
CONFIG_PM_DFS_INIT_AUTO=y

# ===== ‚ö° Brownout Detector Configuration =====
# –ü–æ–Ω–∏–∂–∞–µ–º –ø–æ—Ä–æ–≥ brownout –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞—Ç–∞—Ä–µ—è–º–∏
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä–æ–≥ 2.43V –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–º –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –±–∞—Ç–∞—Ä–µ–π
# –û–ø—Ü–∏–∏: 2.43V (default), 2.33V, 2.26V, 2.17V
# –í–ê–ñ–ù–û: –°–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–∏–π –ø–æ—Ä–æ–≥ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏!
CONFIG_ESP32_BROWNOUT_DET=y
CONFIG_ESP32_BROWNOUT_DET_LVL_SEL_0=y
# CONFIG_ESP32_BROWNOUT_DET_LVL_SEL_1=y  # 2.33V - –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—Å–ª–∏ 2.43V –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç
# CONFIG_ESP32_BROWNOUT_DET_LVL_SEL_2=y  # 2.26V
# CONFIG_ESP32_BROWNOUT_DET_LVL_SEL_3=y  # 2.17V - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥

# ===== üêõ Debug & Development =====
# Panic handler behavior (–¥–ª—è development - print, –¥–ª—è production - reset)
CONFIG_ESP_SYSTEM_PANIC_PRINT_REBOOT=y
# –î–ª—è production:
# CONFIG_ESP_SYSTEM_PANIC_SILENT_REBOOT=y

# Core dump (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
CONFIG_ESP_COREDUMP_ENABLE_TO_NONE=y
# –î–ª—è production —Å SD card:
# CONFIG_ESP_COREDUMP_ENABLE_TO_FLASH=y

# ===== üìä Performance Optimization =====
# Compiler optimization
CONFIG_COMPILER_OPTIMIZATION_PERF=y

# FreeRTOS optimization
CONFIG_FREERTOS_HZ=1000
CONFIG_FREERTOS_ASSERT_ON_UNTESTED_FUNCTION=n

# ===== üîå Component Configuration =====
# ESP32-specific
CONFIG_ESP32_DEFAULT_CPU_FREQ_240=y
CONFIG_ESP32_REV_MIN=3

# BLE/Bluetooth (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
CONFIG_BT_ENABLED=y
CONFIG_BTDM_CTRL_MODE_BLE_ONLY=y
CONFIG_BT_NIMBLE_ENABLED=y

# ===== üì° OTA Configuration =====
# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ OTA updates —Å signature verification
CONFIG_BOOTLOADER_APP_ROLLBACK_ENABLE=y

# Skip version check (–¥–ª—è development)
CONFIG_BOOTLOADER_SKIP_VALIDATE_IN_DEEP_SLEEP=n

# ===== üõ†Ô∏è Build Configuration =====
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π CMake build system
CONFIG_IDF_CMAKE=y

# –í–∫–ª—é—á–∏—Ç—å –≤—Å–µ warnings
CONFIG_COMPILER_WARN_WRITE_STRINGS=y

# Stack overflow detection
CONFIG_FREERTOS_CHECK_STACKOVERFLOW_CANARY=y

# ===== üéØ Memory Configuration =====
# PSRAM configuration (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
# CONFIG_ESP32_SPIRAM_SUPPORT=y

# Memory debugging (–æ—Ç–∫–ª—é—á–∏—Ç—å –≤ production)
CONFIG_HEAP_POISONING_DISABLED=y
# –î–ª—è development:
# CONFIG_HEAP_POISONING_LIGHT=y

# ===== ‚öôÔ∏è Advanced Security Settings =====
# Secure boot digest SHA256
CONFIG_SECURE_BOOT_DIGEST_SHA256=y

# Signature verification –∫–∞–∂–¥—ã–π —Ä–∞–∑
CONFIG_SECURE_BOOT_VERIFICATION_EVERY_BOOT=y

# Hardware secure boot check
CONFIG_SECURE_BOOT_HARDWARE_CHECK=y

# =============================================================================
# –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø:
# =============================================================================
# 1. Secure Boot –∏ Flash Encryption –ù–ï–û–ë–†–ê–¢–ò–ú–´ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –ø—Ä–æ—à–∏–≤–∫–∏!
# 2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ backup –∫–ª—é—á–µ–π –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
# 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –ø–µ—Ä–µ–¥ mass production
# 4. –î–ª—è production –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ mode —Å DEVELOPMENT –Ω–∞ RELEASE
# 5. –û—Ç–∫–ª—é—á–∏—Ç–µ JTAG –≤ production (CONFIG_ESP_SYSTEM_DISABLE_JTAG=y)
# 6. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ aggressive key revoke –≤ production
#
# –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ: docs/security/secure-boot-implementation-guide.md
# =============================================================================
