# 项目汉化扫描报告（重点：屏幕与 Web）（2026-02）

> 本次根据反馈，聚焦 **设备屏幕文案** 与 **Web 页面文案** 的汉化状态，不再以文档翻译为主。

## 1. 扫描范围与方法

### 1.1 重点范围

- 屏幕（TFT/LCD）相关：
  - `src/main.cpp`
  - `src/pin_manager.cpp`
  - `src/display_manager.cpp`
- Web 页面相关：
  - `include/web_pages/*.h`
  - `include/web_pages/*.js`

### 1.2 扫描方法

1. 用 `rg` 定位 `showMessage/updateMessage/drawString` 等屏幕输出调用。
2. 用 Python 统计字符串中中文占比（粗粒度）。
3. 人工抽样核对“用户直接可见文案”，标记中英混用点。

---

## 2. 结论摘要（仅看屏幕 + Web）

- 当前状态：**已汉化但不统一**。
- 屏幕端：核心流程（PIN、AP 模式提示）大部分是中文，但仍存在关键英文状态词（如 `Initializing...`、`Connecting WiFi...`、`Time Synced!`）。
- Web 端：页面模板中文化明显，但核心安全 JS（`auto_secure_initializer.js`、`secure_client.js`）仍几乎全英文。

---

## 3. 屏幕汉化检测结果（重点）

### 3.1 量化统计（字符串维度，粗粒度）

- `src/main.cpp`：302 个字符串，含中文 43 个（**14.2%**）
- `src/pin_manager.cpp`：103 个字符串，含中文 5 个（**4.9%**）
- `src/display_manager.cpp`：65 个字符串，含中文 19 个（**29.2%**）

> 说明：该比例并不等于“用户可见占比”，因为源码里包含日志、常量和非 UI 字符串。

### 3.2 用户可见文案抽样

**已中文化（代表）**
- `请输入 PIN 码`
- `同时按住两个按键可取消`
- `AP 模式已启用`
- `请连接到网络`
- `离线模式`

**仍为英文（建议优先处理）**
- `Initializing...`
- `Connecting WiFi...`
- `Time Sync... (x/3)`
- `Time Synced!`
- 模式按钮中的 `AP`（可评估是否保留缩写）

### 3.3 屏幕端问题判定

- **问题类型**：状态提示类文案中英混用。
- **影响**：首次上手与故障排查时，用户在“同一流程”中接收两套语言，体验割裂。
- **优先级**：P0（建议先统一启动与联网状态词）。

---

## 4. Web 汉化检测结果（重点）

### 4.1 页面文件中文覆盖（字符串维度，粗粒度）

- `page_index.h`：12.9%
- `page_login.h`：22.9%
- `page_register.h`：23.4%
- `page_wifi_setup.h`：28.9%
- `page_splash.h`：41.9%
- `page_test_encryption.h`：50.8%
- `auto_secure_initializer.js`：0%
- `secure_client.js`：0%

### 4.2 Web 端问题判定

1. **页面模板已中文化，但主页面 `page_index.h` 仍混用明显**。  
2. **安全与握手链路 JS 基本未汉化**（报错、提示、日志均以英文为主）。  
3. 对终端用户而言，常见表现是：按钮中文、错误提示英文。

### 4.3 影响

- 当握手失败、密钥交换失败、请求解密失败时，用户看到英文报错，降低可理解性。
- 技术支持需要二次“翻译错误信息”，提高沟通成本。

---

## 5. 优先整改清单（屏幕 + Web）

## P0（本周可做）

1. **统一屏幕启动链路状态词**（`main.cpp` + `display_manager.cpp`）
   - `Initializing...` → `初始化中...`
   - `Connecting WiFi...` → `正在连接 WiFi...`
   - `Time Sync...` → `正在同步时间...`
   - `Time Synced!` → `时间同步完成！`
2. **统一 Web 登录后主流程提示语**（先处理 `page_index.h` 高频提示）

## P1（下一阶段）

1. **翻译安全 JS 用户可见文本**（`auto_secure_initializer.js`、`secure_client.js`）
   - 优先翻译 `alert/throw Error/UI toast` 相关内容。
   - `console.debug` 可保留英文或双语（推荐双语）。
2. **建立“屏幕术语 + Web 术语”统一词表**
   - 例如：握手、会话、隧道、混淆、同步、重连、离线模式。

## P2（机制化）

1. 为 Web 页面抽离 `i18n` 字典，避免继续硬编码。
2. 为屏幕提示增加统一宏或函数，集中维护文案。

---

## 6. 验收标准（面向屏幕与 Web）

- 屏幕可见关键状态词（启动 / 联网 / 时间同步 / 模式切换）中文覆盖率：**100%**。
- Web 关键用户提示（登录、握手、请求失败、保存失败）中文覆盖率：**≥ 90%**。
- 不再出现“同一交互流程内中英混用”的主路径问题（人工走查）。
