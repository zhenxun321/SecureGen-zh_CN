; ESP32 T-Display TOTP - Multifunctional Security Device
; Copyright (c) 2025 Unix-like-SoN
; Licensed under MIT License - see LICENSE file for details

[env:lilygo-t-display]
platform = espressif32
board = lilygo-t-display
framework = arduino
upload_port = /dev/ttyACM0
monitor_port = /dev/ttyACM0
monitor_speed = 115200
board_build.partitions = huge_app.csv
board_build.arduino.stack_size = 16384

; ‚ö° Flash & CPU Performance Optimization
board_build.flash_mode = qout        ; QOUT mode (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π quad I/O) - —É—Å–∫–æ—Ä–µ–Ω–∏–µ —á—Ç–µ–Ω–∏—è flash
board_build.f_flash = 80000000L      ; 80 –ú–ì—Ü flash frequency (+100% vs 40MHz)
board_build.f_cpu = 240000000L       ; 240 –ú–ì—Ü CPU frequency
; ‚ö° IRAM –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã –≤ IRAM –¥–ª—è 4-8x boost:
;   - encryptResponse/decryptRequest (XOR —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ)
;   - sendSecureResponse (HTTP –æ–±—Ä–∞–±–æ—Ç–∫–∞)
;   –û–∂–∏–¥–∞–µ–º–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ: XOR 60-130ms -> 15-30ms
; ‚ö° Integer Math –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ó–∞–º–µ–Ω–∞ float –Ω–∞ fixed-point/integer:
;   - AnimationManager: pow() -> —É–º–Ω–æ–∂–µ–Ω–∏–µ (14.5x –±—ã—Å—Ç—Ä–µ–µ, 320->22 —Ü–∏–∫–ª–∞)
;   - BatteryManager: float voltage -> integer mV (5x –±—ã—Å—Ç—Ä–µ–µ)
;   –í–∏–∑—É–∞–ª—å–Ω–æ –∏–¥–µ–Ω—Ç–∏—á–Ω–æ, –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å <1 –ø–∏–∫—Å–µ–ª—å

lib_deps =
    me-no-dev/AsyncTCP @ 1.1.1
    me-no-dev/ESPAsyncWebServer @ 1.2.4
    bodmer/TFT_eSPI @ 2.5.43
    bblanchon/ArduinoJson @ 7.4.2
    olikraus/U8g2_for_TFT_eSPI @ ^1.0.6
    # mbedTLS components —É–∂–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ ESP32 core
    
build_flags = 
    ; ‚ö°‚ö°‚ö° –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ ‚ö°‚ö°‚ö°
    -O3                                    ; –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞
    -ffast-math                            ; –ë—ã—Å—Ç—Ä—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    -funroll-loops                         ; –†–∞–∑–≤–µ—Ä—Ç–∫–∞ —Ü–∏–∫–ª–æ–≤
    -ffunction-sections                    ; –†–∞–∑–¥–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π
    -fdata-sections                        ; –†–∞–∑–¥–µ–ª—å–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
    
    ; üîã POWER STABILITY - Brownout Protection
    ; –ü–æ–Ω–∏–∂–∞–µ–º –ø–æ—Ä–æ–≥ brownout –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞—Ç–∞—Ä–µ—è–º–∏
    ; 0=2.43V (default), 1=2.33V, 2=2.26V, 3=2.17V
    -DCONFIG_ESP32_BROWNOUT_DET_LVL=0
    
    ; BLE Configuration
    -DCONFIG_BT_NIMBLE_ROLE_PERIPHERAL=1
    -DCONFIG_BT_NIMBLE_ROLE_CENTRAL=0
    -DCONFIG_BT_NIMBLE_MAX_CONNECTIONS=1
    -DUSER_SETUP_LOADED=1
    -DST7789_DRIVER=1
    -DTFT_WIDTH=135
    -DTFT_HEIGHT=240
    -DTFT_MOSI=19
    -DTFT_SCLK=18
    -DTFT_CS=5
    -DTFT_DC=16
    -DTFT_RST=23
    -DTFT_BL=4
    -DTFT_BGR=1 ; Set color order to BGR
    -DTFT_INVERSION_ON=1 ; Try with color inversion
    -DSPI_FREQUENCY=27000000
    -DLOAD_GLCD=1
    -DLOAD_FONT2=1
    -DLOAD_FONT4=1
    -DLOAD_FONT6=1
    -DLOAD_FONT7=1
    -DLOAD_FONT8=1
    -DLOAD_GFXFF=1
    -DSMOOTH_FONT=1
    ; === SECURE LAYER OPTIMIZATION ===
    -DCONFIG_MBEDTLS_HARDWARE_AES=y
    -DCONFIG_MBEDTLS_HARDWARE_SHA=y
    -DCONFIG_MBEDTLS_AES_USE_INTERRUPT=n
    -DCONFIG_MBEDTLS_ENTROPY_HARDWARE=y
    -DSECURE_LAYER_ENABLED=1
